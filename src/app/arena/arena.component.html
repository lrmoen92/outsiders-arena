
<div id="battleDiv">

  <div *ngIf="!inBattle" id="pre-battle">

    <div>
      <div class="playerInfo">
        <img [src]="player.avatarUrl" id="player-portrait">
        <br>
        {{ player.displayName }}
      </div>

      <div id="battle-select">
        <button (click)="findLadderBattle()">
          LADDER MATCH
        </button>
        <button (click)="findQuickBattle()">
          QUICK MATCH
        </button>
        <button (click)="findPrivateBattle()">
          PRIVATE MATCH
        </button>
        <br>
        <input [(ngModel)]="opponentName" placeholder="Opponent's Name"/>
      </div>
    </div>
    <div id="character-select" *ngIf="allCharacters">
      <img *ngFor="let char of allCharacters" (click)="addCharacter(char.id)" [src]="imgPrefix + char.avatarUrl" class="ally-portrait-small">
      <div>
        TEAM:
      </div>
      <img *ngFor="let ally of allies" [src]="imgPrefix + ally.avatarUrl" class="ally-portrait-small" (click)="removeCharacter(ally.id)">
    </div>
  </div>

  <div *ngIf="inBattle" id="battle">
    <div id="header">

      <div class="playerInfo">
        <img [src]="player.avatarUrl" id="player-portrait">
        <br>
        {{ player.displayName }}
      </div>

      <div id="centerPanel">

          <div id="timer">
            <countdown id="countdown" [config]="config" (event)="handleTimerEvent($event)">
  
            </countdown>
            <div id="volumeControls">
              <input type="range" id="volume" min="0" max="1.0" step="0.1" value="0.5" [(ngModel)]="volume">
              <fa-icon [icon]="faVolumeUp"></fa-icon>
            </div>
          </div>

          <div *ngIf="hasTurn" id="energy">
            
            <div id="energy-pool">
              <div class="left-text">TOTAL ENERGY: {{ totalEnergy }}</div>
              <span id="turn-divinity">
                <div *ngFor="let energy of turnDivinity" (click)="spendEnergy(energy, false)" class="energy-divinity energy"></div>
              </span>
              <span id="turn-arcana">
                <div *ngFor="let energy of turnArcana" (click)="spendEnergy(energy, false)" class="energy-arcana energy"></div>
              </span>
              <span id="turn-dexterity">
                <div *ngFor="let energy of turnDexterity" (click)="spendEnergy(energy, false)" class="energy-dexterity energy"></div>
              </span>
              <span id="turn-strength">
                <div *ngFor="let energy of turnStrength" (click)="spendEnergy(energy, false)" class="energy-strength energy"></div>
              </span>
            </div>
            
            <br>

            <div id="spent">
              <div *ngIf="totalSpentEnergy > 0" class="left-text">TOTAL SPENT: {{ totalSpentEnergy }}</div>
              <span id="spent-divinity">
                <div *ngFor="let energy of spentDivinity" (click)="returnEnergy(energy, false)" class="energy-divinity energy"></div>
              </span>
              
              <span id="spent-arcana">
                <div *ngFor="let energy of spentArcana" (click)="returnEnergy(energy, false)" class="energy-arcana energy"></div>
              </span>
              
              <span id="spent-dexterity">
                <div *ngFor="let energy of spentDexterity" (click)="returnEnergy(energy, false)" class="energy-dexterity energy"></div>
              </span>
              
              <span id="spent-strength">
                <div *ngFor="let energy of spentStrength" (click)="returnEnergy(energy, false)" class="energy-strength energy"></div>
              </span>
            </div>

            <span *ngIf="randomsNeeded > 0"> {{ randomsNeeded }} MORE ENERGY NEEDED</span>
            
          </div>

          <div id="actionsHeader">
            <div *ngIf="hasTurn">
              <input class="energyTradeInput" type="radio" [(ngModel)]="energyTrade" id="divinityTrade" value="DIVINITY">
              <div class="energy energy-divinity"></div>
              <input class="energyTradeInput" type="radio" [(ngModel)]="energyTrade" id="arcanaTrade" value="ARCANA">
              <div class="energy energy-arcana"></div>
              <input class="energyTradeInput" type="radio" [(ngModel)]="energyTrade" id="dexterityTrade" value="DEXTERITY">
              <div class="energy energy-dexterity"></div>
              <input class="energyTradeInput" type="radio" [(ngModel)]="energyTrade" id="strengthTrade" value="STRENGTH">
              <div class="energy energy-strength"></div>
            </div>
            <br>
            <div>
              <button (click)="clickEnergyTrade()" [disabled]="!hasTurn || abilitiesAreChosen()">
                Trade
              </button>
              <button (click)="sendTurnEnd()" [disabled]="!hasTurn">
                Finish Turn
              </button>
              <input type="button" id="surrender" (click)="this.areYouSure()" value="SURRENDER" >
              <span *ngIf="showAreYouSure">
                <input type="button" id="surrenderImSure" (click)="this.surrender()" value="I'M SURE" >
              </span>
              <span *ngIf="showAreYouSure">
                <input type="button" id="surrenderImNotSure" (click)="this.youreNotSure()" value="NO WAY" >
              </span>
            </div>
          </div>
      </div>

      <div id="opponentInfo">
        <img [src]="opponent.avatarUrl" id="opponent-portrait">
        <br>
        {{ opponent.displayName }}
      </div>
    </div>

    <div id="body">

          <div class="ally-info">
            <div *ngFor="let ally of battleAllies" class="battle-allies">
              <div class="ally-info-portrait">
                <img [ngStyle]="getCharacterPortrait(ally).style" [src]="getCharacterPortrait(ally).url" class="ally-portrait" (click)="clickTarget(ally.position)">        
                <div>
                  {{ ally.hp }} / 100
                </div>
              </div>

              <div class="ally-info-effects">
                <span *ngFor="let effect of parseHiddenEffects(ally)" class="effect ally-effect">
                  <span [matTooltip]="effectStringParser(effect)" matTooltipClass="my-tooltip">
                    <img [src]="imgPrefix + effect.avatarUrl">
                  </span>
                </span>
              </div>
            </div>
          </div>
          
          <div class="abilities">
            <div *ngFor="let ally of tempAllies" class="ally-abilities">
              <div *ngFor="let ability of ally.abilities" class="ally-ability" (mouseleave)="hideAbilityPanel(false)" (mouseenter)="showAbilityInfo(ability)" (click)="clickAbility(ability)">
                <img [ngStyle]="getAbilityStyle(ability)" [src]="imgPrefix + ability.abilityUrl" class="ally-ability-portrait">
              </div>
            </div>
          </div>

          <div class="enemy-info">
            <div *ngFor="let enemy of battleEnemies" class="battle-enemies">

              <div class="enemy-info-effects">
                <span *ngFor="let effect of parseHiddenEffects(enemy)" class="effect enemy-effect">
                  <span [matTooltip]="effectStringParser(effect)" matTooltipClass="my-tooltip">
                    <img [src]="imgPrefix + effect.avatarUrl">
                  </span>
                </span>
              </div>

              <div class="enemy-info-portrait">
                <img [ngStyle]="getCharacterPortrait(enemy).style" [src]="getCharacterPortrait(enemy).url"  (click)="clickTarget(enemy.position)" class="enemy-portrait">
                <div>
                  {{ enemy.hp }} / 100
                </div>
              </div>
              <br>
  
            </div>
          </div>

    </div>

    <div id="footer">

      <div id="abilityWindow">

        <div id="abilityInfo">
          <div *ngIf="hoveredAbility">
            <div *ngIf="abilityCurrentlyClicked" id="actionsFooter">
              <button (click)="clickCancel()" [disabled]="!hasTurn">
                Cancel
              </button>
            </div>
            <div *ngFor="let energy of hoveredAbility.cost" id="abilityCost" [class]="energy">
            </div>
            <span>{{ hoveredAbility.name }}</span>
            <span id="abilityTargets">Targets: {{ hoveredAbility.targets }}</span>
            <br>
            <span>Cooldown: {{ hoveredAbilityCooldown }} /  {{ hoveredAbility.cooldown }}</span>
            <span id="abilityTypes">{{ hoveredAbility.types }}</span>
            <br>
            <span>{{ hoveredAbility.description }}</span>
            <br>
          </div>
        </div>

        <div *ngIf="isReelEmpty()" id="chosenAbilities">
          <div cdkDropList cdkDropListOrientation="horizontal" class="example-list" (cdkDropListDropped)="drop($event)">
            <div *ngFor="let effect of turnEffects" class="example-box" cdkDrag>
              <img [src]="imgPrefix + effect.avatarUrl" class="ally-ability-portrait">
              <span class="reel-effect-name">
                {{ effect.name }}
              </span>
              <button class="remove-button" *ngIf="effect.instanceId < 0" (click)="removeAbilityFromReel(effect)"> REMOVE </button> 
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>